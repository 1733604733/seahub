{% extends "myhome_base.html" %}
{% load seahub_tags %}

{% block nav_group_class %}class="cur"{% endblock %}

{% block left_panel %}

<h3>管理员</h3>
<ul>
{% for member in managers %}
<li><img src="{{MEDIA_URL}}img/default-person-20.png" alt="{{ member.short_username }}的图标" class="group-member-icon" /><span class="group-member-name">{{ member.short_username }}</span></li>
{% endfor %}

<h3>成员</h3>
{% if common_members %}
<ul>
    {% for member in common_members %}
	<li><img src="{{MEDIA_URL}}img/default-person-20.png" alt="{{ member.short_username }}的图标" class="group-member-icon" /><span class="group-member-name">{{ member.short_username }}</span></li>
    {% endfor %}
</ul>
{% else %}
<p>暂无</p>
{% endif %}

<h3>操作</h3>
<ul class="with-bg">
{% if is_staff %}
	<li><a id="add-member" href="#">添加成员</a></li>
    <li><a id="group-mgr" href="{{ SITE_ROOT }}group/manage/{{ group.id }}/">小组管理</a></li>
{% else %}
	<li><a id="quit-group" href="#">退出小组</a></li>
{% endif %}
</ul>

{% endblock %}

{% block right_panel %}
<h2>{{ group.group_name }}</h2>
<h3>小组里共享的同步目录</h3>
{% if repos %}
<table>
    <tr>
        <th width="20%">名字</th>
        <th width="40%">描述</th>
        <th width="20%">共享来源</th>
        <th width="20%">操作</th>
    </tr>

    {% for repo in repos %}
    <tr>
        <td><a href="{{ SITE_ROOT }}repo/{{ repo.props.id }}/">{{ repo.props.name }}</a></td>
        <td>{{ repo.props.desc }}</td>
        <td>{{ repo.share_from }}</td>
        <td>
        <button data="{{ repo.props.id }}" class="download-btn">下载</button>
        {% if is_staff or repo.share_from_me  %}
        <button data="{{ SITE_ROOT }}shareadmin/removeshare/?repo_id={{ repo.props.id }}&gid={{ group.id }}" class="repo-delete-btn">取消共享</button>
        {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>暂无</p>
{% endif %}

<form id="member-add-form" action="{{ SITE_ROOT }}group/memberadd/" method="post" name="member-add-form" class="hide">
    <label>邮箱:</label><br />
    <input id="user_name" name="user_name" value="" /><br />
    <input type="hidden" id="group_id" name="group_id" value="{{ group.id }}" />
    <input type="submit" value="提交" />
</form>

<div id="dialog-quit-confirm" class="hide">
  <p>确定要退出？</p>
  <button id="quit-yes-btn">确定</button>
  <button class="simplemodal-close">取消</button>
</div>

{% endblock %}

{% block extra_script %}
<script type="text/javascript">
$("#add-member").click(function() {
    $("#member-add-form").modal({appendTo: "#main", containerCss:{padding:18}});
	return false;
});

$("#quit-group").click(function() {
    $('#dialog-quit-confirm').modal({appendTo:'#main'});
	return false;
});
        
$('#quit-yes-btn').click(function() {
    location.href = "{{ SITE_ROOT }}group/quit/?gid={{ group.id }}";
});

addConfirmTo($('.repo-delete-btn'));

/*                
$('.repo-delete-btn').click(function() {
    location.href = $(this).attr('data');
});
*/

$('.download-btn').click(function() {
    window.open('{{ SITE_ROOT }}seafile_access_check/?repo_id=' + $(this).attr('data'));
});        
</script>
{% endblock %}
