{% extends "myhome_base.html" %}
{% load seahub_tags %}

{% block nav_group_class %}class="cur"{% endblock %}
{% block left_panel %}
<h3>操作</h3>
<ul class="with-bg">
    <li><a id="group-remove" href="#" data="{{ SITE_ROOT }}group/rm?gid={{ group.id }}">解散小组</a></li>
    <li><a id="group-info" href="{{ SITE_ROOT }}group/{{ group.id }}/">返回小组</a></li>
</ul>
{% endblock %}

{% block right_panel %}
<h2>{{ group.group_name }} 小组管理</h2>
<h3>小组成员列表<a id="member-add" href="#" class="fright">添加成员</a></h3>
{% if members %}
<table class="member-list">
    <tr>
        <th width="70%">邮箱</th>
        <th width="30%">操作</th>
    </tr>

    {% for member in members %}
    <tr>
        <td>{{ member.user_name }}</td>
        {% if not member.is_staff %}
        <td><button data="{{ member.user_name }}" class="member-remove-btn">删除</button></td>
        {% else %}
        <td></td>
        {% endif %}
    </tr>
    {% endfor %}
</table>
{% else %}
<p>暂无</p>
{% endif %}

<form id="member-remove-form" action="{{ SITE_ROOT }}group/memberrm/" method="post" name="member-remove-form" class="hide">
    <label>邮箱</label><br />
    <input id="user_name" name="user_name" value="" />
    <input type="hidden" id="group_id" name="group_id" value="{{ group.id }}" />
    <input type="submit" value="提交" />
</form>

<form id="member-add-form" action="{{ SITE_ROOT }}group/memberadd/" method="post" name="member-add-form" class="hide">
    <label>邮箱:</label><br />
    <textarea id="added-member-name" name="user_name"></textarea><br />
    <input type="hidden" id="group_id" name="group_id" value="{{ group.id }}" />
	<p class="error hide" id="member-add-error">输入不能为空。</p>
    <input type="submit" value="提交" id="member-add-submit" />
</form>

{% endblock %}

{% block extra_script %}
<script type="text/javascript">
$("#group-remove").click(function() {
	addConfirmTo($(this), '确定要解散该小组吗？');
	return false;
});

$('.member-remove-btn').click(function() {
    $("#user_name").val($(this).attr('data'));
    $("#member-remove-form").submit();
});

var contact_list = [];
{% for contact in contacts %}
contact_list.push('{{ contact.contact_email }}');
{% endfor %}

$("#member-add").click(function() {
    $("#member-add-form").modal({appendTo: "#main"});
    addAutocomplete('#added-member-name', '#member-add-form', contact_list);
    return false;
});

$('#member-add-submit').click(function() {
    if (!$.trim($('#added-member-name').attr('value'))) {
        $('#member-add-error').removeClass('hide');
        return false;
    }
    return true;
});
                
</script>
{% endblock %}
