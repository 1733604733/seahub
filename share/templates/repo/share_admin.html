{% extends "myhome_base.html" %}
{% load seahub_tags %}

{% block nav_shareadmin_class %}class="cur"{% endblock %}

{% block right_panel %}
<h3>我共享的同步目录</h3>
{% if out_repos %}
<table class="repo-list">
    <tr>
        <th width="20%">名字</th>
        <th width="25%">共享给</th>
        <th width="47%">描述</th>
        <th width="8%">操作</th>
    </tr>
    {% for repo in out_repos %}
    <tr>
        <td><a href="{{ SITE_ROOT }}repo/{{ repo.props.id }}">{{ repo.props.name }}</a></td>
        <td>{{ repo.props.shared_email }}</td>
        <td>{{ repo.props.desc }}</td>
        <td>
          {% if repo.gid %}
          <img src="{{ MEDIA_URL }}img/delete-20.png" data="{{ SITE_ROOT }}shareadmin/removeshare/?repo_id={{ repo.props.id }}&from={{ request.user }}&gid={{ repo.gid }}" class="cancel-share vh" alt="取消共享" title="取消共享" />
          {% else %}
          <img src="{{ MEDIA_URL }}img/delete-20.png" data="{{ SITE_ROOT }}shareadmin/removeshare/?repo_id={{ repo.props.id }}&from={{ request.user }}&to={{ repo.props.shared_email }}" class="cancel-share vh" alt="取消共享" title="取消共享" />
          {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>暂无</p>
{% endif %}

<h3>我管理的共享链接</h3>
{% if out_links %}
<table class="link-list">
  <tr>
    <th width="20%">名字</th>
    <th width="30%">共享给</th>
    <th width="30%">有效期</th>    
    <th width="20%">操作</th>
  </tr>
  {% for link in out_links %}
  <tr>
    <td><a href="{{ SITE_ROOT }}repo/{{ repo.id }}">{{ link.repo_name }}</a></td>
    <td>{{ link.anonymous_email }}</td>
    {% if link.remain_time %}
    <td>{{ link.remain_time|translate_remain_time }}</td>
    {% else %}
    <td>已过期</td>
    {% endif %}
    <td><a class="op" href="#" class="view-link" data="{{ link.token }}">查看链接</a>
    <a class="op" href="{{ SITE_ROOT }}share/remove/{{ link.token }}/">删除</a></td>
  </tr>
  {% endfor %}
  
</table>
{% endif %}

<form id="view-link-form" name="view-link-form" class="hide">
  <textarea id="share-link" name="share-link"></textarea>
</form>

{% endblock %}

{% block extra_script %}
<script type="text/javascript">
$('.cancel-share').click(function() {
    location.href = $(this).attr('data');
});

$("table tr:gt(0)").hover(
    function() {
        $(this).find('img').css('cursor', 'pointer').removeClass('vh');
    },
    function() {
        $(this).find('img').addClass('vh');
    }
);

$(".view-link").click(function() {
    var t = $(this).attr('data');
    var l = '{{ protocol }}://' + '{{ domain }}{{ SITE_ROOT }}share/' + t + '/';
    $('textarea[name="share-link"]').val(l);
    $("#view-link-form").modal({appendTo: "#main", containerCss:{padding:18}});
    return false;
});

</script>
{% endblock %}
