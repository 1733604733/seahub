{% load url from future %}
var Bottom_bar = '<div id="bottom-bar">{% if groups %}<button id="recommend">推荐到群组</button> <button id="click-into-group">到所在群组</button>{% endif %}</div>';
$('#wrapper').append(Bottom_bar);
$('#bottom-bar').css({'position':'fixed', 'bottom':0, 'right':'10px'});
$('#main-panel').css('margin-bottom', '28px');
$('#footer').addClass('hide');

{% if groups %}
var group_list = []
{% for group in groups %}
group_list.push('{{ group.props.group_name }} <{{ group.props.creator_name }}>');
{% endfor %}
$('#recommend-to-group-caret').css('left', $('#recommend').offset().left);
$('#recommend').click(function() {
    if ($('#recommend-to-group-form').hasClass('hide')) {
        $('#recommend-to-group-form, #recommend-to-group-caret').removeClass('hide');
    } else {
        $('#recommend-to-group-form, #recommend-to-group-caret').addClass('hide');
    }
});
$(document).click(function(e) {
    var target = e.target || event.srcElement;
    if (!$('#recommend, #recommend-to-group-form, #recommend-to-group-caret').is(target) && !($('#recommend-to-group-form, #recommend-to-group-caret').find('*').is(target))) {
        $('#recommend-to-group-form, #recommend-to-group-caret').addClass('hide');
    }   
});

$('#recommend-submit').click(function() {
    if (!$.trim($('#recommend-to-group-form [name="message"]').val())) {
        apply_form_error('recommend-form', '推荐语不能为空。');
        return false;   
    }
});

$('#main').append('<div id="to-group" class="hide">{{ repo_group_str|escapejs }}</div><div id="to-group-caret" class="hide"><div class="outer-caret"><div class="inner-caret"></div></div></div>');
$('#to-group').css({'width':$('#to-group').width(), 'left':$('#click-into-group').offset().left - $('#to-group').width()/3});
$('#to-group-caret').css('left', $('#click-into-group').offset().left);
$('#click-into-group').click(function() {
    {% if groups|length == 1 %}
    // only one group, just turn to group page
    {% for group in groups %}
    location.href= "{% url 'group_info' group.id %}";
    {% endfor %}
    
    {% else %}
    // more than one group, then let user choose
    if ($('#to-group').hasClass('hide')) {
        $('#to-group, #to-group-caret').removeClass('hide');
    } else {
        $('#to-group, #to-group-caret').addClass('hide');
    }
    {% endif %}
});
$(document).click(function(e) {
    var target = e.target || event.srcElement;
    if (!$('#click-into-group, #to-group, #to-group-caret').is(target) && !($('#to-group, #to-group-caret').find('*').is(target))) {
        $('#to-group, #to-group-caret').addClass('hide');
    }   
});
{% endif %}
