{% extends "myhome_base.html" %}
{% load seahub_tags avatar_tags %}

{% block nav_org_class %}class="cur"{% endblock %}

{% block main_panel %}
<h2>{{ org.org_name }}</h2>
<div class="side fright">
<h3>企业成员</h3>
{% if org_users %}
<ul>
    {% for member in org_users %}
	<li class="org-member">{% avatar member.user_name 16 %}<span class="org-member-name"><a href="{{ SITE_ROOT }}profile/{{ member.email }}/">{{ member.email|email2nickname }}</a></span></li>
    {% endfor %}
</ul>
{% else %}
<p>暂无</p>
{% endif %}

{% if is_join %}
<h3>操作</h3>
<ul class="with-bg">
{% if is_staff %}
    <li><a id="group-mgr" href="{{ SITE_ROOT }}group/{{ group.id }}/members/">小组管理</a></li>
{% else %}
	<li><a id="quit-group" href="#" data="{{ SITE_ROOT }}group/{{ group.id }}/?op=quit">退出小组</a></li>
{% endif %}
</ul>
{% endif %}
</div>

<div class="main fleft">
<h3>企业里公开的同步目录</h3>
{% if repos %}
<table>
    <tr>
        <th width="20%">名字</th>
        <th width="48%">描述</th>
        <th width="22%">共享来源</th>
        <th width="10%">操作</th>
    </tr>

    {% for repo in repos %}
    <tr>
        <td><a href="{{ SITE_ROOT }}repo/{{ repo.props.id }}/">{{ repo.props.name }}</a></td>
        <td>{{ repo.props.desc }}</td>
        <td>{{ repo.owner }}</td>
        <td>
            <img src="{{ MEDIA_URL }}img/download-20.png" class="download vh" data="{{ SITE_ROOT }}seafile_access_check/?repo_id={{ repo.props.id }}" alt="下载" title="下载" />
        {% if is_staff or repo.share_from_me  %}
            <img src="{{ MEDIA_URL }}img/delete-20.png" class="cancel-share vh" data="{{ SITE_ROOT }}shareadmin/removeshare/?repo_id={{ repo.props.id }}&from={{ repo.owner }}&gid={{ group.id }}" title="取消共享" alt="取消共享" />
        {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>暂无</p>
{% endif %}

<h3>企业里的小组</h3>
{% if groups %}
<table>
  <tr>
    <th width="30%">名字</th>
    <th widht="40%">创建者</th>
    <th width="30%">创建时间</th>
  </tr>
  
  {% for group in groups %}
  <tr>
    <td>{{ group.group_name }}</td>
    <td>{{ group.creator_name }}</td>
    <td>{{ group.timestamp|tsstr_sec }}</td>
  </tr>
  {% endfor %}
  
</table>
{% else %}
<p>暂无</p>
{% endif %}
</div>
{% endblock %}

{% block extra_script %}
<script type="text/javascript">
    addConfirmTo($('#quit-group'), '确定要退出？');
    addConfirmTo($('.cancel-share'), '确定要取消共享该目录？');

    $("table tr:gt(0)").hover(
        function() {
            $(this).find('img').css('cursor', 'pointer').removeClass('vh');
        },
        function() {
            $(this).find('img').addClass('vh');
        }
    );

    $('.download').click(function() {
        window.open($(this).attr('data'));
    });
</script>
{% endblock %}
