{% extends "myhome_base.html" %}
{% load seahub_tags avatar_tags %}
{% load url from future %}

{% block nav_publichome_class %}class="cur"{% endblock %}

{% block main_panel %}
{% if messages %}
<ul class="messages hide">
  {% for message in messages %}
  <li class="info">{{ message }}</li>
  {% endfor %}
</ul>
{% endif %}

<div class="side fright">
<h3>成员</h3>
{% if users %}
<ul>
    {% for member in users %}
	<li class="member">{% avatar member.email 16 %}<a class="name" href="{% url 'user_profile' member.email %}">{{ member.email|email2nickname }}</a></li>
    {% endfor %}
</ul>
{% else %}
<p>暂无</p>
{% endif %}
</div>

<div class="main fleft">
<h3>公开的同步目录</h3>
<button id="repo-create">新建同步目录</button>
{% if public_repos %}
<table>
    <tr>
        <th width="20%">名字</th>
        <th width="40%">描述</th>
        <th width="15%">更新时间</th>
        <th width="15%">共享来源</th>
        <th width="10%">操作</th>
    </tr>
    {% for repo in public_repos %}
    <tr>
        <td><a href="{% url 'repo' repo.id %}">{{ repo.props.name }}</a></td>
        <td>{{ repo.props.desc }}</td>
        {% if repo.latest_modify %}
        <td>{{ repo.latest_modify|translate_commit_time }}</td>
        {% else %}
        <td>--</td>
        {% endif %}
        <td>{{ repo.owner|email2nickname }}</td>
        <td>
            <img src="{{ MEDIA_URL }}img/sync-20.png" data="{{ repo.props.id }}" class="download-btn vh" title="同步到本地" alt="同步" />
            <img src="{{ MEDIA_URL }}img/delete-20.png" data="{% url 'views.unset_inner_pub_repo' repo.id %}" class="unshare-btn vh" title="取消共享" alt="取消共享" />
        </td>
    </tr>
    {% endfor %}
</table>
{% endif %}

<!-- 信息栏 -->
<div id="innerpub-msg">
    <h3>信息栏</h3>
    <form id="innerpub-msg-form" action="" method="post">
        <textarea name="message" id="message">{{ form.data.message }}</textarea><br />
        {% for error in form.message.errors %}
        <p class="error">{{ error|escape }}</p>
        {% endfor %}
        <input type="submit" value="提交" class="submit" />
    </form>
</div>
{% if innerpub_msgs %}
    <ul class="msg-list">
    {% for msg in innerpub_msgs %}
        <li class="msg w100 ovhd">
        <div class="pic fleft">
            <a href="{{ SITE_ROOT }}profile/{{ msg.from_email }}/">{% avatar msg.from_email 48 %}</a>
        </div>
        <div class="txt fright">
            <div class="msg-hd">
                <span class="time">{{ msg.timestamp|translate_commit_time }}</span>
                <a href="{{ SITE_ROOT }}profile/{{ msg.from_email }}/" title="{{ msg.from_email }}">{{ msg.from_email|email2nickname }}</a>
            </div>
            <div class="msg-bd">
                <p>
                {{ msg.message|seahub_urlize|find_at|linebreaksbr }}
                </p>
                <button class="reply op" data="{% url 'innerpub_msg_reply' msg.id %}"><span class="reply-cnt">{% if msg.reply_cnt != 0 %}{{ msg.reply_cnt }} {% endif %}</span>回复</button>
                <button class="replyclose op hide">收起回复</button>
                <div class="reply-bd"></div>
            </div>
        </div>
        </li>
    {% endfor %}
    </ul>
{% endif %}
    <div id="paginator">
        {% if current_page != 1 %}
        <a href="{{ SITE_ROOT }}group/{{ group.id}}/?page={{ prev_page }}&per_page={{ per_page }}">上一页</a>
        {% endif %}
        {% if page_next %}
        <a href="{{ SITE_ROOT }}group/{{ group.id }}/?page={{ next_page }}&per_page={{ per_page }}">下一页</a>
        {% endif %}
    </div>
<!-- /信息栏 -->
</div>
<!-- /.main -->
{% include "snippets/repo_share_form.html" %}
{% include "snippets/repo_create_form.html" %}
{% include "snippets/user_profile_html.html" %}

{% endblock %}

{% block extra_script %}
{% include "snippets/user_profile_js.html" %}
<script type="text/javascript">
{% include "snippets/myhome_extra_script.html" %}
{% url 'seahub.views.public_repo_create' as repo_create_url %}
{% with post_url=repo_create_url %}
    {% include "snippets/repo_create_js.html" %}
{% endwith %}

{% include 'group/msg_reply_js.html' %}
</script>
{% endblock %}
