{% extends base_template %}
{% load seahub_tags avatar_tags %}
{% load url from future %}

{% block main_panel %}
<div class="w100 ovhd">
    <h2 class="fleft">{{repo.props.name}} 修改历史</h2>
    <button data="{{ SITE_ROOT }}repo/{{ repo.props.id }}/" class="fright" id="back">返回同步目录</button>
</div>

<p class="tip">Tip：在每次修改后会生成一个镜像，记录修改之前的目录状态。<a href="{% url 'repo_view_snapshot' repo.props.id %}">查看镜像</a></p>
<div class="commit-list-outer-container">
    <div class="commit-list-inner-container">
        <table class="commit-list">
            <tr>
                <th width="20%" class="time">修改时间</th>
                <th width="20%">修改者</th>
                <th width="60%">描述</th>
            </tr>

            {% for commit in commits %}
            <tr>
                <td class="time">{{ commit.ctime|translate_commit_time }}</td>
                <td>
                {% if commit.creator_name %}
                    <a href="{{ SITE_ROOT }}profile/{{ commit.creator_name }}/">{% avatar commit.creator_name 16 %}</a>
                    <a href="{{ SITE_ROOT }}profile/{{ commit.creator_name }}/">{{ commit.creator_name|email2nickname }}</a>
                {% else %}
                未知
                {% endif %}
                </td>
                <td>
                    {{ commit.props.desc|translate_commit_desc }}
                    {% if page_next or not forloop.last %}
                    <a class="lsch" href="{{ SITE_ROOT }}repo/history/changes/{{ repo.id }}/?commit_id={{ commit.id }}" data="{{ commit.props.ctime|tsstr_sec }}">详情</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
        <div id="paginator">
            {% if current_page != 1 %}
            <a href="?page={{ prev_page }}&per_page={{ per_page }}">上一页</a>
            {% endif %}
            {% if page_next %}
            <a href="?page={{ next_page }}&per_page={{ per_page }}">下一页</a>
            {% endif %}
            <span>每页：</span>
            {% if per_page == 25 %}
            <span> 25 </span>
            {% else %}
            <a href="?per_page=25" class="per-page">25</a>
            {% endif %}
            {% if per_page == 50 %}
            <span> 50 </span>
            {% else %}
            <a href="?per_page=50" class="per-page">50</a>
            {% endif %}
            {% if per_page == 100 %}
            <span> 100 </span> 
            {% else %}
            <a href="?per_page=100" class="per-page">100</a>
            {% endif %}
        </div>
        <div id="ls-ch" class="hide"></div><!--list modification details of a commit-->
    </div>
</div>
{% endblock %}

{% block extra_script %}
<script type="text/javascript">
    {% include 'snippets/list_commit_detail.html' %}
    $('#back').click(function() {
        location.href = $(this).attr('data');
    });
</script>
{% endblock %}
