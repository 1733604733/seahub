{% extends "myhome_base.html" %}

{% block nav_home_class %}class="cur"{% endblock %}
{% block left_panel %}
<h3>已用空间</h3>
<p>{{ quota_usage|filesizeformat }} / 4 GB</p>
{% endblock %}


{% block right_panel %}

<h3>我拥有的同步目录</h3>
{% if owned_repos %}
<table class="repo-list">
    <tr>
        <th width="30%">名字</th>
        <th width="50%">描述</th>
        <th width="20%">操作</th>
    </tr>

    {% for repo in owned_repos %}
    <tr>
        <td><a href="{{ SITE_ROOT }}repo/{{ repo.props.id }}/">{{ repo.props.name }}</a></td>
        <td>{{ repo.props.desc }}</td>
        <td>
        <button data="{{ SITE_ROOT }}repo/download/{{ repo.props.id }}/?repo_name={{ repo.props.name}}&enc={{ repo.props.encrypted}}" class="repo-download-btn">下载</button>
        <button data="{{ repo.props.id }}" class="repo-share-btn">共享</button>
        <button data="{{ SITE_ROOT }}repo/remove/{{ repo.props.id }}/" class="repo-delete-btn">删除</button>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>暂无</p>
{% endif %}

<h3>我获取的同步目录</h3>
{% if fetched_repos %}
<table class="repo-list">
    <tr>
        <th width="30%">名字</th>
        <th width="50%">描述</th>
        <th width="20%">操作</th>
    </tr>

    {% for repo in fetched_repos %}
    <tr>
        <td><a href="{{ SITE_ROOT }}repo/{{ repo.props.id }}/">{{ repo.props.name }}</a></td>
        <td>{{ repo.props.desc }}</td>
        <td>
        <button data="{{ SITE_ROOT }}repo/download/{{ repo.props.id }}/" class="repo-download-btn">下载</button>
        <button data="{{ SITE_ROOT }}repo/removefetched/{{ repo.userid }}/{{ repo.props.id }}/" class="repo-delete-btn">删除</button>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>暂无</p>
{% endif %}

<form id="repo-share-form" action="{{ SITE_ROOT }}shareadmin/addshare/" method="post" name="repo-share-form" class="hide">
    <label>邮箱</label><br />
    <input id="to_email" type="text" name="to_email" value="" maxlength="40" /><br/>
    <input id="share_repo_id" type="hidden" name="share_repo_id" value="" />
    <input type="submit" value="提交" />
</form>

{% endblock %}

{% block extra_script %}
<script type="text/javascript">
$(".repo-share-btn").click(function() {
    repo_id = $(this).attr("data");
    $("#share_repo_id").val(repo_id);
    $("#repo-share-form").modal({appendTo: "#main", containerCss:{padding:18}});
});

$(".repo-download-btn").click(function() {
    location.href = $(this).attr("data");
});

addConfirmTo($('.repo-delete-btn'));
</script>
{% endblock %}
