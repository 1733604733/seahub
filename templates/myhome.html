{% extends "myhome_base.html" %}

{% block nav_home_class %}class="cur"{% endblock %}
{% block left_panel %}
<h3>已用空间</h3>
<p>{{ quota_usage|filesizeformat }} / 4 GB</p>
{% endblock %}


{% block right_panel %}
{% if output_msg %}
{% for key, value in output_msg.items %}
{% if key == 'info_msg' %}
<span class="info-msg" style="background-color:lightgreen">{{ value }} 前往<a href="{{ SITE_ROOT }}shareadmin/">共享管理</a>查看</span><br />
{% endif %}
{% if key == 'err_msg' %}
<span class="err-msg" style="background-color:pink">{{ value }}</span><br />
{% endif %}
{% endfor %}
{% endif %}

<h3>我拥有的同步目录</h3>
{% if owned_repos %}
<table class="repo-list">
    <tr>
        <th width="30%">名字</th>
        <th width="50%">描述</th>
        <th width="20%">操作</th>
    </tr>

    {% for repo in owned_repos %}
    <tr>
        <td><a href="{{ SITE_ROOT }}repo/{{ repo.props.id }}/">{{ repo.props.name }}</a></td>
        <td>{{ repo.props.desc }}</td>
        <td>
        <button data="{{ SITE_ROOT }}download/repo/?repo_id={{ repo.props.id }}" class="download-btn">下载</button>
        <button data="{{ repo.props.id }}" class="repo-share-btn">共享</button>
        <button data="{{ SITE_ROOT }}repo/remove/{{ repo.props.id }}/" class="repo-delete-btn">删除</button>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>暂无</p>
{% endif %}

<h3>共享给我的同步目录</h3>
{% if in_repos %}
<table class="repo-list">
    <tr>
        <th width="30%">名字</th>
        <th width="20%">共享来源</th>
        <th width="35%">描述</th>
        <th width="15%">操作</th>
    </tr>

    {% for repo in in_repos %}
    <tr>
        <td><a href="{{ SITE_ROOT }}repo/{{ repo.props.id }}">{{ repo.props.name }}</a></td>
        <td>{{ repo.props.shared_email }}</td>
        <td>{{ repo.props.desc }}</td>
        <td>
          <button data="{{ SITE_ROOT }}download/repo/?repo_id={{ repo.props.id }}" class="download-btn">下载</button>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>暂无</p>
{% endif %}

<form id="repo-share-form" action="{{ SITE_ROOT }}home/my/" method="post" name="repo-share-form" class="hide">
    <label>邮箱(多个邮箱以;分隔)</label><br />
    <textarea id="to_email" name="to_email" value="" cols="30" rows="5" ></textarea><br />
    <input id="share_repo_id" type="hidden" name="share_repo_id" value="" />
    <input type="submit" value="提交" />
</form>

{% endblock %}

{% block extra_script %}
<script type="text/javascript">
$(".repo-share-btn").click(function() {
    repo_id = $(this).attr("data");
    $("#share_repo_id").val(repo_id);
    $("#repo-share-form").modal({appendTo: "#main", containerCss:{padding:18}});
});

addConfirmTo($('.repo-delete-btn'));
</script>
{% endblock %}
